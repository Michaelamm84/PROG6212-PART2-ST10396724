@model dynamic

<h1>Contract Details</h1>

@if (ViewBag.ValidationErrors != null)
{
    <h2>Validation Results</h2>
    <ul>
        @foreach (var error in ViewBag.ValidationErrors)
        {
            <li>@error</li>
        }
    </ul>
}

<h2>Input Claim ID</h2>

<form id="claimForm">
    <div>
        <label for="ClaimID">Claim ID:</label>
        <input type="text" id="ClaimID" name="ClaimID" required />
    </div>
    <button type="button" id="fetchDetails">Get Contract Details</button>
</form>

<div id="contractDetails" style="display: none;">
    <h2>Contract Details</h2>
    <table>
        <thead>
            <tr>
                <th>Claim ID</th>
                <th>Hours Worked</th>
                <th>Hourly Pay</th>
                <th>Contract Value</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td id="detailClaimID"></td>
                <td id="detailHoursWorked"></td>
                <td id="detailHourlyPay"></td>
                <td id="detailContractValue"></td>
            </tr>
        </tbody>
    </table>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        // Fetch contract details on button click
        $("#fetchDetails").on("click", function () {
            var claimID = $("#ClaimID").val();

            if (!claimID) {
                alert("Please enter a valid Claim ID.");
                return;
            }

            $.ajax({
                url: '/Operations/GetContractDetails', // Server-side endpoint
                method: 'GET',
                data: { claimID: claimID },
                success: function (response) {
                    if (response.success) {
                        // Populate the contract details
                        $("#detailClaimID").text(response.data.ClaimID);
                        $("#detailHoursWorked").text(response.data.hoursWorked);
                        $("#detailHourlyPay").text(response.data.hourlyPay);

                        // Calculate the contract value on the client side
                        var contractValue = response.data.hoursWorked * response.data.hourlyPay;
                        $("#detailContractValue").text(contractValue.toFixed(2));

                        // Show the contract details table
                        $("#contractDetails").show();
                    } else {
                        alert(response.message);
                    }
                },
                error: function () {
                    alert("An error occurred while fetching the contract details.");
                }
            });
        });
    });
</script>
